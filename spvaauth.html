
<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>security AuthN &amp; AuthZ &#8212; PVXS 1.3.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <script src="_static/documentation_options.js?v=bb516dca"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="icon" href="_static/favicon.png"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="security Cert Management" href="spvacerts.html" />
    <link rel="prev" title="security Secure PVAccess" href="spva.html" />

   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

<!-- Material Icons -->
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<!-- Material Symbols Outlined -->
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">

<!-- Inject extra CSS for pages starting with 'spva' -->
<link rel="stylesheet" type="text/css" href="_static/style.css" />


  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="security-authn-authz">
<span id="authn-and-authz"></span><h1><i class="material-symbols-outlined" style="vertical-align: middle;">security</i> AuthN &amp; AuthZ<a class="headerlink" href="#security-authn-authz" title="Link to this heading">¶</a></h1>
<p><a class="reference internal" href="spvaglossary.html#glossary-auth-vs-authz"><span class="std std-ref">AutheNtication and AuthoriZation</span></a> with Secure PVAccess</p>
<ul class="simple">
<li><p><strong>AutheNtication</strong> determines and verifies the identity of a client or server.</p></li>
<li><p><strong>AuthoriZation</strong> defines and enforces access rights to PV resources.</p></li>
</ul>
<p>SPVA enhances <a class="reference internal" href="#epics-security"><span class="std std-ref">EPICS Security</span></a> with fine-grained control based on:</p>
<ul class="simple">
<li><p><strong>Authentication Mode</strong> - choose between <code class="docutils literal notranslate"><span class="pre">server-only</span></code>, <code class="docutils literal notranslate"><span class="pre">mutual</span></code>, or <code class="docutils literal notranslate"><span class="pre">none</span></code></p></li>
<li><p><strong>Authentication Method</strong> - either legacy (<code class="docutils literal notranslate"><span class="pre">ca</span></code>), spva (<code class="docutils literal notranslate"><span class="pre">x509</span></code>), or none (<code class="docutils literal notranslate"><span class="pre">anonymous</span></code>)</p></li>
<li><p><strong>Certificate Authority</strong> - Only allow authorised access matching <code class="docutils literal notranslate"><span class="pre">Common</span> <span class="pre">Name</span></code> of Certificate Authority</p></li>
<li><p><strong>Transport Type</strong> - for unauthenticated clients provide access based on transport - legacy (not <code class="docutils literal notranslate"><span class="pre">isTLS</span></code>), or tls encapsulated (<code class="docutils literal notranslate"><span class="pre">isTLS</span></code>)</p></li>
<li><p><strong>Encapsulation Mode</strong> - packets are encrypted (<code class="docutils literal notranslate"><span class="pre">tls</span></code>),  or unencrypted (<code class="docutils literal notranslate"><span class="pre">tcp</span></code>)</p></li>
</ul>
<section id="authentication-modes">
<span id="id1"></span><h2>Authentication Modes<a class="headerlink" href="#authentication-modes" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Mutual</span></code>: Both client and server are authenticated via certificates (spva: Method is <code class="docutils literal notranslate"><span class="pre">x509</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Server-only</span></code>: Only server is authenticated via certificate (hybrid: Method is <code class="docutils literal notranslate"><span class="pre">ca</span></code> or <code class="docutils literal notranslate"><span class="pre">anonymous</span></code>, but <code class="docutils literal notranslate"><span class="pre">isTLS</span></code> flag is true)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Un-authenticated</span></code>: Credentials supplied in <code class="docutils literal notranslate"><span class="pre">AUTHZ</span></code> message (legacy: Method is <code class="docutils literal notranslate"><span class="pre">ca</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Unknown</span></code>: No credentials (legacy: Method is <code class="docutils literal notranslate"><span class="pre">anonymous</span></code>)</p></li>
</ul>
<section id="legacy-authentication-mode">
<span id="determining-identity"></span><h3>Legacy Authentication Mode<a class="headerlink" href="#legacy-authentication-mode" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Un-authenticated</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Unknown</span></code></p></li>
</ul>
<img alt="Identity in PVAccess" class="align-center" src="_images/pvaident.png" />
<ol class="arabic simple">
<li><p>Optional <code class="docutils literal notranslate"><span class="pre">AUTHZ</span></code> message from client:</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>AUTHZ<span class="w"> </span>method:<span class="w"> </span>ca
AUTHZ<span class="w"> </span>user:<span class="w"> </span>george
AUTHZ<span class="w"> </span>host:<span class="w"> </span>McInPro.level-n.com
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Server uses PeerInfo structure:</p></li>
</ol>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">PeerInfo</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">peer</span><span class="p">;</span><span class="w">      </span><span class="c1">// network address</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">transport</span><span class="p">;</span><span class="w"> </span><span class="c1">// protocol (e.g., &quot;pva&quot;)</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">authority</span><span class="p">;</span><span class="w"> </span><span class="c1">// auth mechanism</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">realm</span><span class="p">;</span><span class="w">     </span><span class="c1">// authority scope</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">account</span><span class="p">;</span><span class="w">   </span><span class="c1">// user name</span>
<span class="p">}</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>PeerInfo fields map to <code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">asAddClient</span></code> parameters …</p></li>
<li><p>for authorization through the <code class="docutils literal notranslate"><span class="pre">ACF</span></code> definitions of <a href="#id2"><span class="problematic" id="id3">``</span></a>UAG``s and <a href="#id4"><span class="problematic" id="id5">``</span></a>ASG``s …</p></li>
<li><p>to control access to PVs</p></li>
</ol>
</section>
<section id="secure-pvaccess-authentication-mode">
<h3>Secure PVAccess Authentication Mode<a class="headerlink" href="#secure-pvaccess-authentication-mode" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">Mutual</span></code></p></li>
<li><p><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">Server-only</span></code></p></li>
</ul>
<img alt="Identity in Secure PVAccess" class="align-center" src="_images/spvaident.png" />
<ol class="arabic simple">
<li><p>Client Identity optionally established via X.509 certificate during TLS handshake:</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>CN:<span class="w"> </span>greg
O:<span class="w"> </span>SLAC.stanford.edu
OU:<span class="w"> </span>SLAC<span class="w"> </span>National<span class="w"> </span>Accelerator<span class="w"> </span>Laboratory
C:<span class="w"> </span>US
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>EPICS agent optionally verifies certificate via trust chain</p></li>
<li><p>PeerCredentials structure provides peer information:</p></li>
</ol>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">PeerCredentials</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">peer</span><span class="p">;</span><span class="w">      </span><span class="c1">// network address</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">iface</span><span class="p">;</span><span class="w">     </span><span class="c1">// network interface</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">method</span><span class="p">;</span><span class="w">    </span><span class="c1">// &quot;anonymous&quot;, &quot;ca&quot;, or &quot;x509&quot;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">authority</span><span class="p">;</span><span class="w"> </span><span class="c1">// CA common name for x509 if mode is `Mutual` or blank</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">account</span><span class="p">;</span><span class="w">   </span><span class="c1">// User account if mode is `Mutual` or blank</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">isTLS</span><span class="p">;</span><span class="w">            </span><span class="c1">// Secure transport status.  True is mode is `Mutual` or `Server-Only`</span>
<span class="p">};</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Extended <code class="docutils literal notranslate"><span class="pre">asAddClientX()</span></code> function provides …</p></li>
<li><p>authorization control (enhanced with <code class="docutils literal notranslate"><span class="pre">isTls</span></code>, <code class="docutils literal notranslate"><span class="pre">METHOD</span></code>, and <code class="docutils literal notranslate"><span class="pre">AUTHORITY</span></code>) through the ACF definitions of UAGs and ASGs …</p></li>
<li><p>to control access to PVs (enhanced with addition of <code class="docutils literal notranslate"><span class="pre">RPC</span></code>)</p></li>
</ol>
</section>
</section>
<section id="authentication-methods">
<span id="site-authentication-methods"></span><h2>Authentication Methods<a class="headerlink" href="#authentication-methods" title="Link to this heading">¶</a></h2>
<p>A new authentication method is added with SPVA - <code class="docutils literal notranslate"><span class="pre">x509</span></code>.  This supercedes the legacy <code class="docutils literal notranslate"><span class="pre">ca</span></code>, and
<code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">anonymous</span></code> authentication methods.  With <code class="docutils literal notranslate"><span class="pre">x509</span></code> EPICS clients can use a variety of Site Authentication Methods that
all integrate with Secure PVAccess via a PKCS#12 keychain file ( <span class="xref std std-ref">glossary_pkcs12</span> ) and the certificate and keys that it contains.</p>
<p><strong>Authenticator</strong>:</p>
<p>Authenticators are ways of generating the PKCS#12 keychain file by
using credentials (tickets, tokens, or other identity-affirming methods) from existing authentication methods
that may be in use in a particular installation site.  The simplest is called “Standard Authenticator” (<code class="docutils literal notranslate"><span class="pre">std</span></code>) and it
allows a user to create an arbitrary x509 certificate that has to be <code class="docutils literal notranslate"><span class="pre">APPROVED</span></code> by a network administrator before
it is allowed on the network.</p>
<p>Tools that start with <code class="docutils literal notranslate"><span class="pre">authn</span></code> e.g. <code class="docutils literal notranslate"><span class="pre">authnstd</span></code> are the commandline interfaces to these Authenticators.</p>
<p>Each new Authenticator requires:</p>
<section id="authenticator-implementation">
<h3>1. Authenticator Implementation<a class="headerlink" href="#authenticator-implementation" title="Link to this heading">¶</a></h3>
<p>Create under <code class="docutils literal notranslate"><span class="pre">/certs/authn/&lt;name&gt;</span></code>:</p>
<ul class="simple">
<li><p><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">authn&lt;name&gt;main.cpp</span></code> - Main runner (copy from template)</p></li>
<li><p><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">authn&lt;name&gt;.cpp</span></code> - Main implementation subclassing <code class="docutils literal notranslate"><span class="pre">Authn</span></code>, includes registration</p></li>
<li><p><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">authn&lt;name&gt;.h</span></code> - Header file</p></li>
<li><p><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">config&lt;name&gt;.cpp</span></code> - Configuration interface subclassing <code class="docutils literal notranslate"><span class="pre">AuthnConfig</span></code></p></li>
<li><p><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">config&lt;name&gt;.h</span></code> - Header file</p></li>
<li><p><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">Makefile</span></code> - Build configuration</p></li>
<li><p><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">README.md</span></code> - Documentation</p></li>
</ul>
</section>
<section id="ccr-message-verifier">
<h3>2. CCR Message Verifier<a class="headerlink" href="#ccr-message-verifier" title="Link to this heading">¶</a></h3>
<p>Create under <code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">/certs/authn/</span></code>:</p>
<ul class="simple">
<li><p><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">&lt;name&gt;verifier.cpp</span></code> - Verifier implementation for <a class="reference internal" href="spvacerts.html#pvacms"><span class="std std-ref">PVACMS</span></a></p></li>
<li><p><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">&lt;name&gt;verifier.h</span></code> - Header file with required macros/constants</p></li>
<li><p><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">&lt;name&gt;VERIFIER_RULES</span></code> - Makefile rules for <a class="reference internal" href="spvacerts.html#pvacms"><span class="std std-ref">PVACMS</span></a> integration</p></li>
<li><p><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">&lt;name&gt;VERIFIER_CONFIG</span></code> - Makefile configuration for <a class="reference internal" href="spvacerts.html#pvacms"><span class="std std-ref">PVACMS</span></a></p></li>
</ul>
</section>
<section id="build-flag-to-enable-code-to-be-compiled-in">
<h3>3. Build flag to enable code to be compiled in<a class="headerlink" href="#build-flag-to-enable-code-to-be-compiled-in" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>choose a make flag name of the form <code class="docutils literal notranslate"><span class="pre">PVXS_ENABLE_&lt;NAME&gt;_AUTH</span></code> where <code class="docutils literal notranslate"><span class="pre">NAME</span></code>
is a three or four letter acronynm. e.g. <code class="docutils literal notranslate"><span class="pre">KRB</span></code></p></li>
<li><p>update <code class="docutils literal notranslate"><span class="pre">/certs/authn/Makefile</span></code> to add a line at the end similar to the following:</p></li>
</ul>
<div class="highlight-make notranslate"><div class="highlight"><pre><span></span><span class="c">#--------------------------------------------</span>
<span class="c">#  ADD AUTHENTICATOR PLUGINS AFTER THIS LINE</span>

<span class="cp">ifeq ($(PVXS_ENABLE_KRB_AUTH),YES)</span>
<span class="cp">include $(AUTHN)/krb/Makefile</span>
<span class="cp">endif</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Sites compiling PVXS will set these macros in their private <code class="docutils literal notranslate"><span class="pre">CONFIG_SITE.local</span></code> stored one level above
the root of the source tree.  e.g.</p></li>
</ul>
<div class="highlight-make notranslate"><div class="highlight"><pre><span></span><span class="nv">PVXS_ENABLE_KRB_AUTH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>YES
<span class="nv">PVXS_ENABLE_LDAP_AUTH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>YES
<span class="nv">PVXS_ENABLE_JWT_AUTH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>NO
</pre></div>
</div>
</section>
<section id="extra-options-for-pvacms">
<h3>4. Extra options for PVACMS<a class="headerlink" href="#extra-options-for-pvacms" title="Link to this heading">¶</a></h3>
<p>If you need to add some options to the commandline for PVACMS for your
Authenticator just override these methods in the base <code class="docutils literal notranslate"><span class="pre">Auth</span></code> class.  e.g. for LDAP
below:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">AuthNLdap</span><span class="w"> </span><span class="k">final</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Auth</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// Copy config settings into the Authenticator</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">configure</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">client</span><span class="o">::</span><span class="n">Config</span><span class="w"> </span><span class="o">&amp;</span><span class="n">config</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">config_ldap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">ConfigLdap</span><span class="w"> </span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="n">config</span><span class="p">);</span>
<span class="w">        </span><span class="n">ldap_server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">config_ldap</span><span class="p">.</span><span class="n">ldap_host</span><span class="p">;</span>
<span class="w">        </span><span class="n">ldap_port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">config_ldap</span><span class="p">.</span><span class="n">ldap_port</span><span class="p">;</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="c1">// Define placeholder text e.g. `command [placeholder] [options] positional parameters`</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="nf">getOptionsPlaceholderText</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">&quot; [ldap options]&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Define the help text for the options</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="nf">getOptionsHelpText</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="w">               </span><span class="s">&quot;ldap options</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="w">               </span><span class="s">&quot;        --ldap-host &lt;host&gt;                   LDAP Host.  Default localhost</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="w">               </span><span class="s">&quot;        --ldap-port &lt;port&gt;                   LDAP port.  Default 389</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Add options to given commandline parser</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">addOptions</span><span class="p">(</span><span class="n">CLI</span><span class="o">::</span><span class="n">App</span><span class="w"> </span><span class="o">&amp;</span><span class="n">app</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">client</span><span class="o">::</span><span class="n">Config</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">authn_config_map</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">authn_config_map</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">PVXS_LDAP_AUTH_TYPE</span><span class="p">);</span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">config_ldap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">ConfigLdap</span><span class="w"> </span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">config</span><span class="p">);</span>
<span class="w">        </span><span class="n">app</span><span class="p">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&quot;--ldap-host&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">config_ldap</span><span class="p">.</span><span class="n">ldap_host</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Specify LDAP hostname or IP address&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">app</span><span class="p">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&quot;--ldap-port&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">config_ldap</span><span class="p">.</span><span class="n">ldap_port</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Specify LDAP port number&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
</section>
<section id="extra-environment-variables-for-pvacms">
<h3>5. Extra environment variables for PVACMS<a class="headerlink" href="#extra-environment-variables-for-pvacms" title="Link to this heading">¶</a></h3>
<p>If you need to add some environment variables for PVACMS for your Authenticator
just override these methods in the base <code class="docutils literal notranslate"><span class="pre">Auth</span></code> and <code class="docutils literal notranslate"><span class="pre">ConfigAuthN</span></code> classes.
e.g. for Kerberos shown below.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">AuthNKrb</span><span class="w"> </span><span class="k">final</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Auth</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// Copy config settings into the Authenticator</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">configure</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">client</span><span class="o">::</span><span class="n">Config</span><span class="w"> </span><span class="o">&amp;</span><span class="n">config</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">config_krb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">ConfigKrb</span><span class="w"> </span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="n">config</span><span class="p">);</span>
<span class="w">        </span><span class="n">krb_validator_service_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SB</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">config_krb</span><span class="p">.</span><span class="n">krb_validator_service</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">PVXS_KRB_DEFAULT_VALIDATOR_CLUSTER_PART</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">config_krb</span><span class="p">.</span><span class="n">krb_realm</span><span class="p">;</span>
<span class="w">        </span><span class="n">krb_realm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">config_krb</span><span class="p">.</span><span class="n">krb_realm</span><span class="p">;</span>
<span class="w">        </span><span class="n">krb_keytab_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">config_krb</span><span class="p">.</span><span class="n">krb_keytab</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Update the definitions map for display of effective config</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">updateDefs</span><span class="p">(</span><span class="n">client</span><span class="o">::</span><span class="n">Config</span><span class="o">::</span><span class="n">defs_t</span><span class="w"> </span><span class="o">&amp;</span><span class="n">defs</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">defs</span><span class="p">[</span><span class="s">&quot;KRB5_KTNAME&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">krb_keytab_file</span><span class="p">;</span>
<span class="w">        </span><span class="n">defs</span><span class="p">[</span><span class="s">&quot;KRB5_CLIENT_KTNAME&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">krb_keytab_file</span><span class="p">;</span>
<span class="w">        </span><span class="n">defs</span><span class="p">[</span><span class="s">&quot;EPICS_AUTH_KRB_VALIDATOR_SERVICE&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">krb_validator_service_name</span><span class="p">;</span>
<span class="w">        </span><span class="n">defs</span><span class="p">[</span><span class="s">&quot;EPICS_AUTH_KRB_REALM&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">krb_realm</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Construct a new AuthNKrb, configured from the environment</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">fromEnv</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">client</span><span class="o">::</span><span class="n">Config</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">config</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="n">reset</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ConfigKrb</span><span class="p">(</span><span class="n">ConfigKrb</span><span class="o">::</span><span class="n">fromEnv</span><span class="p">()));</span><span class="w"> </span><span class="p">}</span>
<span class="p">};</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ConfigKrb</span><span class="w"> </span><span class="k">final</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">ConfigAuthN</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">ConfigKrb</span><span class="o">&amp;</span><span class="w"> </span><span class="n">applyEnv</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Config</span><span class="o">::</span><span class="n">applyEnv</span><span class="p">(</span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="n">CLIENT</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Make a new config containing the base classes environment settings plus any</span>
<span class="w">    </span><span class="c1">// environment variables for this Authenticator</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">ConfigKrb</span><span class="w"> </span><span class="n">fromEnv</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ConfigKrb</span><span class="p">{}.</span><span class="n">applyEnv</span><span class="p">();</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">defs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">        </span><span class="n">config</span><span class="p">.</span><span class="n">fromAuthEnv</span><span class="p">(</span><span class="n">defs</span><span class="p">);</span>
<span class="w">        </span><span class="n">config</span><span class="p">.</span><span class="n">fromKrbEnv</span><span class="p">(</span><span class="n">defs</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">config</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">ConfigKrb</span><span class="o">::</span><span class="n">fromKrbEnv</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">defs</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">PickOne</span><span class="w"> </span><span class="n">pickone</span><span class="p">{</span><span class="n">defs</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">};</span>

<span class="w">        </span><span class="c1">// KRB5_KTNAME</span>
<span class="w">        </span><span class="c1">// This is the environment variable defined by krb5</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pickone</span><span class="p">({</span><span class="s">&quot;KRB5_KTNAME&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;KRB5_CLIENT_KTNAME&quot;</span><span class="p">}))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">krb_keytab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pickone</span><span class="p">.</span><span class="n">val</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// EPICS_AUTH_KRB_REALM</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pickone</span><span class="p">({</span><span class="s">&quot;EPICS_AUTH_KRB_VALIDATOR_SERVICE&quot;</span><span class="p">}))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">krb_validator_service</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pickone</span><span class="p">.</span><span class="n">val</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// EPICS_AUTH_KRB_REALM</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pickone</span><span class="p">({</span><span class="s">&quot;EPICS_AUTH_KRB_REALM&quot;</span><span class="p">}))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">krb_realm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pickone</span><span class="p">.</span><span class="n">val</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
</section>
<section id="authenticators">
<h3>Authenticators<a class="headerlink" href="#authenticators" title="Link to this heading">¶</a></h3>
<section id="type-0-basic-credentials">
<span id="pvacms-type-0-auth-methods"></span><h4>TYPE <code class="docutils literal notranslate"><span class="pre">0</span></code> - Basic Credentials<a class="headerlink" href="#type-0-basic-credentials" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>Uses basic information:</p>
<ul>
<li><p>CN: Common name</p>
<ul>
<li><p>Commandline flag: <code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">-n</span></code> <code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">--name</span></code></p></li>
<li><p>Username</p></li>
</ul>
</li>
<li><p>O: Organisation</p>
<ul>
<li><p>Commandline flag: <code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">-o</span></code> <code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">--organization</span></code></p></li>
<li><p>Hostname</p></li>
<li><p>IP address</p></li>
</ul>
</li>
<li><p>OU: Organisational Unit</p>
<ul>
<li><p>Commandline flag: <code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">--ou</span></code></p></li>
</ul>
</li>
<li><p>C: Country</p>
<ul>
<li><p>Commandline flag: <code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">-c</span></code> <code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">--country</span></code></p></li>
<li><p>Locale (not reliable)</p></li>
<li><p>Default = “US”</p></li>
</ul>
</li>
</ul>
</li>
<li><p>No verification performed</p></li>
<li><p>Certificates start in <code class="docutils literal notranslate"><span class="pre">PENDING_APPROVAL</span></code> state</p></li>
<li><p>Requires administrator approval</p></li>
</ul>
</section>
<section id="type-1-independently-verifiable-tokens">
<span id="pvacms-type-1-auth-methods"></span><h4>TYPE <code class="docutils literal notranslate"><span class="pre">1</span></code> - Independently Verifiable Tokens<a class="headerlink" href="#type-1-independently-verifiable-tokens" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>Tokens verified independently or via endpoint (e.g., JWT)</p></li>
<li><p>Verification methods:</p>
<ul>
<li><p>Token signature verification</p></li>
<li><p>Token payload validation</p></li>
<li><p>Verification endpoint calls</p></li>
</ul>
</li>
</ul>
</section>
<section id="type-2-source-verifiable-tokens">
<span id="pvacms-type-2-auth-methods"></span><h4>TYPE <code class="docutils literal notranslate"><span class="pre">2</span></code> - Source Verifiable Tokens<a class="headerlink" href="#type-2-source-verifiable-tokens" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>Requires programmatic API integration (e.g., Kerberos)</p></li>
<li><p>Adds verifiable data to <a class="reference internal" href="spvacerts.html#certificate-creation-request-ccr"><span class="std std-ref">Certificate Creation Request (CCR)</span></a> message</p></li>
<li><p><a class="reference internal" href="spvacerts.html#pvacms"><span class="std std-ref">PVACMS</span></a> uses method-specific libraries for verification</p></li>
</ul>
</section>
</section>
<section id="common-environment-variables-for-all-authenticators">
<h3>Common Environment Variables for all Authenticators<a class="headerlink" href="#common-environment-variables-for-all-authenticators" title="Link to this heading">¶</a></h3>
<p><strong>Configuration options for Standard Authenticator</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Keys and Values</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">EPICS_PVA_AUTH</div>
<div class="line">_NAME</div>
</div>
</td>
<td rowspan="2"><div class="line-block">
<div class="line">{name to use}</div>
<div class="line">e.g. <code class="docutils literal notranslate"><span class="pre">archiver</span></code>
e.g. <code class="docutils literal notranslate"><span class="pre">IOC1</span></code></div>
<div class="line">e.g. <code class="docutils literal notranslate"><span class="pre">greg</span></code></div>
<div class="line"><br /></div>
</div>
</td>
<td rowspan="2"><div class="line-block">
<div class="line">Name to use in new certificates</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">EPICS_PVAS_AUTH</div>
<div class="line">_NAME</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">EPICS_PVA_AUTH</div>
<div class="line">_ORGANIZATION</div>
</div>
</td>
<td rowspan="2"><div class="line-block">
<div class="line">{organization to use}</div>
<div class="line">e.g. <code class="docutils literal notranslate"><span class="pre">site.epics.org</span></code>
e.g. <code class="docutils literal notranslate"><span class="pre">SLAC.STANFORD.EDU</span></code></div>
<div class="line">e.g. <code class="docutils literal notranslate"><span class="pre">KLYS:LI01:101</span></code></div>
<div class="line">e.g. <code class="docutils literal notranslate"><span class="pre">centos07</span></code></div>
</div>
</td>
<td rowspan="2"><div class="line-block">
<div class="line">Organization to use in new certificates</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">EPICS_PVAS_AUTH</div>
<div class="line">_ORGANIZATION</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line"><a href="#id8"><span class="problematic" id="id9">EPICS_PVA_AUTH_</span></a></div>
<div class="line">ORGANIZATIONAL_UNIT</div>
</div>
</td>
<td rowspan="2"><div class="line-block">
<div class="line">{organization unit to use}</div>
<div class="line">e.g. <code class="docutils literal notranslate"><span class="pre">data</span> <span class="pre">center</span></code>
e.g. <code class="docutils literal notranslate"><span class="pre">ops</span></code></div>
<div class="line">e.g. <code class="docutils literal notranslate"><span class="pre">prod</span></code></div>
<div class="line">e.g. <code class="docutils literal notranslate"><span class="pre">remote</span></code></div>
</div>
</td>
<td rowspan="2"><div class="line-block">
<div class="line">Organization Unit to use in new certificates</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line"><a href="#id10"><span class="problematic" id="id11">EPICS_PVAS_AUTH_</span></a></div>
<div class="line">ORGANIZATIONAL_UNIT</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">EPICS_PVA_AUTH</div>
<div class="line">_COUNTRY</div>
</div>
</td>
<td rowspan="2"><div class="line-block">
<div class="line">{country to use}</div>
<div class="line">e.g. <code class="docutils literal notranslate"><span class="pre">US</span></code>
e.g. <code class="docutils literal notranslate"><span class="pre">CA</span></code></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td rowspan="2"><div class="line-block">
<div class="line">Country to use in new certificates.</div>
<div class="line">Must be a two digit country code</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">EPICS_PVAS_AUTH</div>
<div class="line">_COUNTRY</div>
</div>
</td>
</tr>
</tbody>
</table>
</section>
<section id="included-reference-authenticators">
<h3>Included Reference Authenticators<a class="headerlink" href="#included-reference-authenticators" title="Link to this heading">¶</a></h3>
<p>Though it is recommended that you create your own site-specific Authenticators PVXS provides four reference implementations:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">authnstd</span></code> : Standard Authenticator - Uses explcitly specified and unverified credentials</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">authnkrb</span></code> : Kerberos Authenticator - Kerberos credentials verified by the KDC</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">authnldap</span></code>: LDAP Authenticator     - Login to LDAP directory to establish identity</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">authnjwt</span></code> : JWT Authenticator      - JWT tokens obtained by OAuth and verified against the token issuer</p></li>
</ul>
<section id="authstd-configuration-and-usage">
<h4>authstd Configuration and Usage<a class="headerlink" href="#authstd-configuration-and-usage" title="Link to this heading">¶</a></h4>
<p>This Authenticator is used for explicitly specified and unverified credentials.
It can be used to create a certificate with a username and hostname.</p>
<ul class="simple">
<li><p><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">CN</span></code> field in the certificate will be the logged in username</p>
<ul>
<li><p>unless the <code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">-n</span></code> <code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">--name</span></code> commandline option is set</p></li>
<li><p>unless the <code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">EPICS_PVA_AUTH_NAME</span></code>, <code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">EPICS_PVAS_AUTH_NAME</span></code> environment variable is set</p></li>
</ul>
</li>
<li><p><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">O</span></code> field in the certificate will be the hostname or ip address</p>
<ul>
<li><p>unless the <code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">-o</span></code> <code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">--organization</span></code>  commandline option is set</p></li>
<li><p>unless the <code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">EPICS_PVA_AUTH_ORGANIZATION</span></code>, <code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">EPICS_PVAS_AUTH_ORGANIZATION</span></code> environment variable is set</p></li>
</ul>
</li>
<li><p><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">OU</span></code> field in the certificate will not be set</p>
<ul>
<li><p>unless the <code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">--ou</span></code>  commandline option is set</p></li>
<li><p>unless the <code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">EPICS_PVA_AUTH_ORGANIZATIONAL_UNIT</span></code>, <code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">EPICS_PVAS_AUTH_ORGANIZATIONAL_UNIT</span></code> environment variable is set</p></li>
</ul>
</li>
<li><p><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">C</span></code> field in the certificate will be set to the local country code</p>
<ul>
<li><p>unless the <code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">-c</span></code> <code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">--country</span></code>  commandline option is set</p></li>
<li><p>unless the <code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">EPICS_PVA_AUTH_COUNTRY</span></code>, <code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">EPICS_PVAS_AUTH_COUNTRY</span></code> environment variable is set</p></li>
</ul>
</li>
</ul>
<p><strong>usage</strong></p>
<p>Uses the standard <code class="docutils literal notranslate"><span class="pre">EPICS_PVA_TLS_&lt;name&gt;</span></code> environment variables to determine the keychain,
and password file locations.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>authnstd<span class="w"> </span>-<span class="w"> </span>Secure<span class="w"> </span>PVAccess<span class="w"> </span>with<span class="w"> </span>Standard<span class="w"> </span>Authentication

Generates<span class="w"> </span>client,<span class="w"> </span>server,<span class="w"> </span>or<span class="w"> </span>hybrid<span class="w"> </span>certificates<span class="w"> </span>based<span class="w"> </span>on<span class="w"> </span>the<span class="w"> </span>standard<span class="w"> </span>authentication<span class="w"> </span>method.
Uses<span class="w"> </span>specified<span class="w"> </span>parameters<span class="w"> </span>to<span class="w"> </span>create<span class="w"> </span>certificates<span class="w"> </span>that<span class="w"> </span>require<span class="w"> </span>administrator<span class="w"> </span>APPROVAL<span class="w"> </span>before<span class="w"> </span>becoming<span class="w"> </span>VALID.

usage:
<span class="w">  </span>authnstd<span class="w"> </span><span class="o">[</span>options<span class="o">]</span><span class="w">                         </span>Create<span class="w"> </span>certificate<span class="w"> </span><span class="k">in</span><span class="w"> </span>PENDING_APPROVAL<span class="w"> </span>state
<span class="w">  </span>authnstd<span class="w"> </span><span class="o">(</span>-h<span class="w"> </span><span class="p">|</span><span class="w"> </span>--help<span class="o">)</span><span class="w">                     </span>Show<span class="w"> </span>this<span class="w"> </span><span class="nb">help</span><span class="w"> </span>message<span class="w"> </span>and<span class="w"> </span><span class="nb">exit</span>
<span class="w">  </span>authnstd<span class="w"> </span><span class="o">(</span>-V<span class="w"> </span><span class="p">|</span><span class="w"> </span>--version<span class="o">)</span><span class="w">                  </span>Print<span class="w"> </span>version<span class="w"> </span>and<span class="w"> </span><span class="nb">exit</span>

options:
<span class="w">  </span><span class="o">(</span>-u<span class="w"> </span><span class="p">|</span><span class="w"> </span>--cert-usage<span class="o">)</span><span class="w"> </span>&lt;usage&gt;<span class="w">                </span>Specify<span class="w"> </span>the<span class="w"> </span>certificate<span class="w"> </span>usage.<span class="w">  </span>client<span class="p">|</span>server<span class="p">|</span>hybrid.<span class="w">  </span>Default<span class="w"> </span><span class="sb">`</span>client<span class="sb">`</span>
<span class="w">  </span><span class="o">(</span>-n<span class="w"> </span><span class="p">|</span><span class="w"> </span>--name<span class="o">)</span><span class="w"> </span>&lt;name&gt;<span class="w">                       </span>Specify<span class="w"> </span>common<span class="w"> </span>name<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>certificate.<span class="w"> </span>Default<span class="w"> </span>&lt;logged-in-username&gt;
<span class="w">  </span><span class="o">(</span>-o<span class="w"> </span><span class="p">|</span><span class="w"> </span>--organization<span class="o">)</span><span class="w"> </span>&lt;organization&gt;<span class="w">       </span>Specify<span class="w"> </span>organisation<span class="w"> </span>name<span class="w"> </span><span class="k">for</span><span class="w"> </span>the<span class="w"> </span>certificate.<span class="w"> </span>Default<span class="w"> </span>&lt;hostname&gt;
<span class="w">        </span>--ou<span class="w"> </span>&lt;org-unit&gt;<span class="w">                      </span>Specify<span class="w"> </span>organisational<span class="w"> </span>unit<span class="w"> </span><span class="k">for</span><span class="w"> </span>the<span class="w"> </span>certificate.<span class="w"> </span>Default<span class="w"> </span>&lt;blank&gt;
<span class="w">  </span><span class="o">(</span>-c<span class="w"> </span><span class="p">|</span><span class="w"> </span>--country<span class="o">)</span><span class="w"> </span>&lt;country&gt;<span class="w">                 </span>Specify<span class="w"> </span>country<span class="w"> </span><span class="k">for</span><span class="w"> </span>the<span class="w"> </span>certificate.<span class="w"> </span>Default<span class="w"> </span>locale<span class="w"> </span>setting<span class="w"> </span><span class="k">if</span><span class="w"> </span>detectable<span class="w"> </span>otherwise<span class="w"> </span><span class="sb">`</span>US<span class="sb">`</span>
<span class="w">  </span><span class="o">(</span>-t<span class="w"> </span><span class="p">|</span><span class="w"> </span>--time<span class="o">)</span><span class="w"> </span>&lt;minutes&gt;<span class="w">                    </span>Duration<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>certificate<span class="w"> </span><span class="k">in</span><span class="w"> </span>minutes
<span class="w">  </span><span class="o">(</span>-D<span class="w"> </span><span class="p">|</span><span class="w"> </span>--daemon<span class="o">)</span><span class="w">                            </span>Start<span class="w"> </span>a<span class="w"> </span>daemon<span class="w"> </span>that<span class="w"> </span>re-requests<span class="w"> </span>a<span class="w"> </span>certificate<span class="w"> </span>on<span class="w"> </span>expiration<span class="sb">`</span>
<span class="w">        </span>--add-config-uri<span class="w">                     </span>Add<span class="w"> </span>a<span class="w"> </span>config<span class="w"> </span>uri<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>generated<span class="w"> </span>certificate
<span class="w">        </span>--config-uri-base<span class="w"> </span>&lt;config_uri_base&gt;<span class="w">  </span>Specifies<span class="w"> </span>the<span class="w"> </span>config<span class="w"> </span>URI<span class="w"> </span>base<span class="w"> </span>to<span class="w"> </span>add<span class="w"> </span>to<span class="w"> </span>a<span class="w"> </span>certificate.<span class="w">  </span>Default<span class="w"> </span><span class="sb">`</span>CERT:CONFIG<span class="sb">`</span>
<span class="w">        </span>--force<span class="w">                              </span>Force<span class="w"> </span>overwrite<span class="w"> </span><span class="k">if</span><span class="w"> </span>certificate<span class="w"> </span>exists
<span class="w">  </span><span class="o">(</span>-v<span class="w"> </span><span class="p">|</span><span class="w"> </span>--verbose<span class="o">)</span><span class="w">                           </span>Verbose<span class="w"> </span>mode
<span class="w">  </span><span class="o">(</span>-d<span class="w"> </span><span class="p">|</span><span class="w"> </span>--debug<span class="o">)</span><span class="w">                             </span>Debug<span class="w"> </span>mode
</pre></div>
</div>
<p><strong>Environment Variables for authnstd</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Keys and Values</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line"><a href="#id12"><span class="problematic" id="id13">EPICS_AUTH_</span></a></div>
<div class="line">_CERT_VALIDITY_MINS</div>
</div>
</td>
<td><div class="line-block">
<div class="line">&lt;number of minutes&gt;</div>
<div class="line">e.g. <code class="docutils literal notranslate"><span class="pre">525960</span></code> for 1 year</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Amount of minutes before the certificate expires.</div>
<div class="line"><br /></div>
</div>
</td>
</tr>
</tbody>
</table>
<p><strong>Examples</strong></p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># create a client certificate for greg@slac.stanford.edu</span>
authnstd<span class="w"> </span>-u<span class="w"> </span>client<span class="w"> </span>-n<span class="w"> </span>greg<span class="w"> </span>-o<span class="w"> </span>slac.stanford.edu
</pre></div>
</div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># create a server certificate for IOC1</span>
authnstd<span class="w"> </span>-u<span class="w"> </span>server<span class="w"> </span>-n<span class="w"> </span>IOC1<span class="w"> </span>-o<span class="w"> </span><span class="s2">&quot;KLI:LI01:10&quot;</span><span class="w"> </span>--ou<span class="w"> </span><span class="s2">&quot;FACET&quot;</span>
</pre></div>
</div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># create a hybrid certificate for gateway1</span>
authnstd<span class="w"> </span>-u<span class="w"> </span>hybrid<span class="w"> </span>-n<span class="w"> </span>gateway1<span class="w"> </span>-o<span class="w"> </span>bridge.ornl.gov<span class="w"> </span>--ou<span class="w"> </span><span class="s2">&quot;Networking&quot;</span>
</pre></div>
</div>
</section>
<section id="authkrb-configuration-and-usage">
<h4>authkrb Configuration and Usage<a class="headerlink" href="#authkrb-configuration-and-usage" title="Link to this heading">¶</a></h4>
<p>This Authenticator is a TYPE <code class="docutils literal notranslate"><span class="pre">2</span></code> Authenticator.
It can be used to create a certificate from a Kerberos ticket.</p>
<p>A user will need to have a Kerberos ticket to use this Authenticator typically
using the <code class="docutils literal notranslate"><span class="pre">kinit</span></code> command.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>kinit<span class="w"> </span>-l<span class="w"> </span>24h<span class="w"> </span>greg@SLAC.STANFORD.EDU
</pre></div>
</div>
<ul class="simple">
<li><p><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">CN</span></code> field in the certificate will be kerberos username</p></li>
<li><p><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">O</span></code> field in the certificate will be the kerberos realm</p></li>
<li><p><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">OU</span></code> field in the certificate will not be set</p></li>
<li><p><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">C</span></code> field in the certificate will be set to the local country code</p></li>
</ul>
<p><strong>usage</strong></p>
<p>Uses the standard <code class="docutils literal notranslate"><span class="pre">EPICS_PVA_TLS_&lt;name&gt;</span></code> environment variables to determine the keychain,
and password file locations.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>authnkrb<span class="w"> </span>-<span class="w"> </span>Secure<span class="w"> </span>PVAccess<span class="w"> </span>Kerberos<span class="w"> </span>Authenticator

Generates<span class="w"> </span>client,<span class="w"> </span>server,<span class="w"> </span>or<span class="w"> </span>hybrid<span class="w"> </span>certificates<span class="w"> </span>based<span class="w"> </span>on<span class="w"> </span>the<span class="w"> </span>kerberos<span class="w"> </span>Authenticator.
Uses<span class="w"> </span>current<span class="w"> </span>kerberos<span class="w"> </span>ticket<span class="w"> </span>to<span class="w"> </span>create<span class="w"> </span>certificates<span class="w"> </span>with<span class="w"> </span>the<span class="w"> </span>same<span class="w"> </span>validity<span class="w"> </span>as<span class="w"> </span>the<span class="w"> </span>ticket.

usage:
<span class="w">  </span>authnkrb<span class="w"> </span><span class="o">[</span>options<span class="o">]</span><span class="w">                         </span>Create<span class="w"> </span>certificate
<span class="w">  </span>authnkrb<span class="w"> </span><span class="o">(</span>-h<span class="w"> </span><span class="p">|</span><span class="w"> </span>--help<span class="o">)</span><span class="w">                     </span>Show<span class="w"> </span>this<span class="w"> </span><span class="nb">help</span><span class="w"> </span>message<span class="w"> </span>and<span class="w"> </span><span class="nb">exit</span>
<span class="w">  </span>authnkrb<span class="w"> </span><span class="o">(</span>-V<span class="w"> </span><span class="p">|</span><span class="w"> </span>--version<span class="o">)</span><span class="w">                  </span>Print<span class="w"> </span>version<span class="w"> </span>and<span class="w"> </span><span class="nb">exit</span>

options:
<span class="w">  </span><span class="o">(</span>-u<span class="w"> </span><span class="p">|</span><span class="w"> </span>--cert-usage<span class="o">)</span><span class="w"> </span>&lt;usage&gt;<span class="w">                </span>Specify<span class="w"> </span>the<span class="w"> </span>certificate<span class="w"> </span>usage.<span class="w">  </span>client<span class="p">|</span>server<span class="p">|</span>hybrid.<span class="w">  </span>Default<span class="w"> </span><span class="sb">`</span>client<span class="sb">`</span>
<span class="w">        </span>--krb-validator<span class="w"> </span>&lt;service-name&gt;<span class="w">       </span>Specify<span class="w"> </span>kerberos<span class="w"> </span>validator<span class="w"> </span>name.<span class="w">  </span>Default<span class="w"> </span><span class="sb">`</span>pvacms<span class="sb">`</span>
<span class="w">        </span>--krb-realm<span class="w"> </span>&lt;krb-realm&gt;<span class="w">              </span>Specify<span class="w"> </span>the<span class="w"> </span>kerberos<span class="w"> </span>realm.<span class="w">  </span>If<span class="w"> </span>not<span class="w"> </span>specified<span class="w"> </span>we<span class="err">&#39;</span>ll<span class="w"> </span>take<span class="w"> </span>it<span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>ticket
<span class="w">  </span><span class="o">(</span>-D<span class="w"> </span><span class="p">|</span><span class="w"> </span>--daemon<span class="o">)</span><span class="w">                            </span>Start<span class="w"> </span>a<span class="w"> </span>daemon<span class="w"> </span>that<span class="w"> </span>re-requests<span class="w"> </span>a<span class="w"> </span>certificate<span class="w"> </span>on<span class="w"> </span>expiration<span class="sb">`</span>
<span class="w">        </span>--add-config-uri<span class="w">                     </span>Add<span class="w"> </span>a<span class="w"> </span>config<span class="w"> </span>uri<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>generated<span class="w"> </span>certificate
<span class="w">        </span>--config-uri-base<span class="w"> </span>&lt;config_uri_base&gt;<span class="w">  </span>Specifies<span class="w"> </span>the<span class="w"> </span>config<span class="w"> </span>URI<span class="w"> </span>base<span class="w"> </span>to<span class="w"> </span>add<span class="w"> </span>to<span class="w"> </span>a<span class="w"> </span>certificate.<span class="w">  </span>Default<span class="w"> </span><span class="sb">`</span>CERT:CONFIG<span class="sb">`</span>
<span class="w">        </span>--force<span class="w">                              </span>Force<span class="w"> </span>overwrite<span class="w"> </span><span class="k">if</span><span class="w"> </span>certificate<span class="w"> </span>exists
<span class="w">  </span><span class="o">(</span>-v<span class="w"> </span><span class="p">|</span><span class="w"> </span>--verbose<span class="o">)</span><span class="w">                           </span>Verbose<span class="w"> </span>mode
<span class="w">  </span><span class="o">(</span>-d<span class="w"> </span><span class="p">|</span><span class="w"> </span>--debug<span class="o">)</span><span class="w">                             </span>Debug<span class="w"> </span>mode
</pre></div>
</div>
<p><strong>Environment Variables for PVACMS AuthnKRB Verifier</strong></p>
<p>The environment variables and parameters in the following table configure the Kerberos
Credentials Verifier for <a class="reference internal" href="spvacerts.html#pvacms"><span class="std std-ref">PVACMS</span></a> at runtime.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Env. <em>authnkrb</em></p></th>
<th class="head"><p>Env. <em>pvacms</em></p></th>
<th class="head"><p>Params. <em>authkrb</em></p></th>
<th class="head"><p>Params. <em>pvacms</em></p></th>
<th class="head"><p>Keys and Values</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td rowspan="2"><div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">KRB5_KTNAME</div>
<div class="line"><br /></div>
</div>
</td>
<td rowspan="2"><div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td rowspan="2"><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">--krb-keytab</span></code></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td rowspan="2"><div class="line-block">
<div class="line">{string location of keytab file}</div>
<div class="line">e.g. <code class="docutils literal notranslate"><span class="pre">/etc/security/keytab</span></code></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td rowspan="2"><div class="line-block">
<div class="line">This is the keytab file shared with <a class="reference internal" href="spvacerts.html#pvacms"><span class="std std-ref">PVACMS</span></a> by the KDC so</div>
<div class="line">that it can verify kerberos tickets</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">KRB5_CLIENT_KTNAME</div>
<div class="line"><br /></div>
</div>
</td>
</tr>
<tr class="row-even"><td colspan="2"><div class="line-block">
<div class="line">EPICS_AUTH_KRB_VALIDATOR_SERVICE</div>
<div class="line"><br /></div>
</div>
</td>
<td colspan="2"><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">--krb-validator</span></code></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">{this is validator service name}</div>
<div class="line">e.g. <code class="docutils literal notranslate"><span class="pre">pvacms</span></code></div>
</div>
</td>
<td><div class="line-block">
<div class="line">The name of the service user created in the KDC that the pvacms</div>
<div class="line">service will log in as.  <code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">/cluster&#64;{realm}</span></code> will be added</div>
</div>
</td>
</tr>
<tr class="row-odd"><td colspan="2"><div class="line-block">
<div class="line">EPICS_AUTH_KRB_REALM</div>
</div>
</td>
<td colspan="2"><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">--krb-realm</span></code></div>
</div>
</td>
<td><div class="line-block">
<div class="line">e.g. <code class="docutils literal notranslate"><span class="pre">EPICS.ORG</span></code></div>
</div>
</td>
<td><div class="line-block">
<div class="line">Kerberos REALM to authenticate against</div>
</div>
</td>
</tr>
</tbody>
</table>
<p><strong>Setup of Kerberos in Docker Container for testing</strong></p>
<p>In the source code under /examples/docker/spva_krb you’ll find a Dockerfile and supporting resources for creating an environment
that contains a working kerberos KDC with the following characteristics:</p>
<ul class="simple">
<li><p>users (both unix and kerberos principals)</p>
<ul>
<li><p>pvacms - service principal with private keytab file for authentication in ~/.config/pva/1.3/pvacms.keytab</p></li>
<li><p>admin - principal with password “secret” (includes a configured PVACMS administrator certificate)</p></li>
<li><p>softioc - service principal with password “secret”</p></li>
<li><p>client - principal with password “secret”</p></li>
</ul>
</li>
<li><p>services</p>
<ul>
<li><p>KDC</p></li>
<li><p>kadmin Daemon</p></li>
<li><p>PVACMS</p></li>
</ul>
</li>
</ul>
</section>
<section id="authldap-configuration-and-usage">
<h4>authldap Configuration and Usage<a class="headerlink" href="#authldap-configuration-and-usage" title="Link to this heading">¶</a></h4>
<p>This Authenticator is a TYPE <code class="docutils literal notranslate"><span class="pre">2</span></code> Authenticator.
It can be used to create a certificate by logging in to the LDAP directory service.</p>
<p>A user will be prompted to log in to the LDAP directory service to verify their identity.</p>
<ul class="simple">
<li><p><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">CN</span></code> field in the certificate will be LDAP username</p></li>
<li><p><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">O</span></code> field in the certificate will be the LDAP domain parts concatenated with “.”</p></li>
<li><p><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">OU</span></code> field in the certificate will not be set</p></li>
<li><p><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">C</span></code> field in the certificate will be set to the local country code</p></li>
</ul>
<p><strong>usage</strong></p>
<p>Uses the standard <code class="docutils literal notranslate"><span class="pre">EPICS_PVA_TLS_&lt;name&gt;</span></code> environment variables to determine the keychain,
and password file locations.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>authnldap<span class="w"> </span>-<span class="w"> </span>Secure<span class="w"> </span>PVAccess<span class="w"> </span>LDAP<span class="w"> </span>Authenticator

Generates<span class="w"> </span>client,<span class="w"> </span>server,<span class="w"> </span>or<span class="w"> </span>hybrid<span class="w"> </span>certificates<span class="w"> </span>based<span class="w"> </span>on<span class="w"> </span>the<span class="w"> </span>LDAP<span class="w"> </span>credentials.

usage:
<span class="w">  </span>authnldap<span class="w"> </span><span class="o">[</span>options<span class="o">]</span><span class="w">                        </span>Create<span class="w"> </span>certificate<span class="w"> </span><span class="k">in</span><span class="w"> </span>PENDING_APPROVAL<span class="w"> </span>state
<span class="w">  </span>authnldap<span class="w"> </span><span class="o">(</span>-h<span class="w"> </span><span class="p">|</span><span class="w"> </span>--help<span class="o">)</span><span class="w">                    </span>Show<span class="w"> </span>this<span class="w"> </span><span class="nb">help</span><span class="w"> </span>message<span class="w"> </span>and<span class="w"> </span><span class="nb">exit</span>
<span class="w">  </span>authnldap<span class="w"> </span><span class="o">(</span>-V<span class="w"> </span><span class="p">|</span><span class="w"> </span>--version<span class="o">)</span><span class="w">                 </span>Print<span class="w"> </span>version<span class="w"> </span>and<span class="w"> </span><span class="nb">exit</span>

options:
<span class="w">  </span><span class="o">(</span>-u<span class="w"> </span><span class="p">|</span><span class="w"> </span>--cert-usage<span class="o">)</span><span class="w"> </span>&lt;usage&gt;<span class="w">                </span>Specify<span class="w"> </span>the<span class="w"> </span>certificate<span class="w"> </span>usage.<span class="w">  </span>client<span class="p">|</span>server<span class="p">|</span>hybrid.<span class="w">  </span>Default<span class="w"> </span><span class="sb">`</span>client<span class="sb">`</span>
<span class="w">  </span><span class="o">(</span>-n<span class="w"> </span><span class="p">|</span><span class="w"> </span>--name<span class="o">)</span><span class="w"> </span>&lt;name&gt;<span class="w">                       </span>Specify<span class="w"> </span>LDAP<span class="w"> </span>username<span class="w"> </span><span class="k">for</span><span class="w"> </span>common<span class="w"> </span>name<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>certificate.
<span class="w">                                             </span>e.g.<span class="w"> </span><span class="nv">name</span><span class="w"> </span><span class="o">==</span>&gt;<span class="w"> </span>LDAP:<span class="w"> </span><span class="nv">uid</span><span class="o">=</span>name,<span class="w"> </span><span class="nv">ou</span><span class="o">=</span><span class="nv">People</span><span class="w"> </span><span class="o">==</span>&gt;<span class="w"> </span>Cert:<span class="w"> </span><span class="nv">CN</span><span class="o">=</span>name
<span class="w">                                             </span>Default<span class="w"> </span>&lt;logged-in-username&gt;
<span class="w">  </span><span class="o">(</span>-o<span class="w"> </span><span class="p">|</span><span class="w"> </span>--organization<span class="o">)</span><span class="w"> </span>&lt;organization&gt;<span class="w">       </span>Specify<span class="w"> </span>LDAP<span class="w"> </span>org<span class="w"> </span><span class="k">for</span><span class="w"> </span>organization<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>certificate.
<span class="w">                                             </span>e.g.<span class="w"> </span>epics.org<span class="w"> </span><span class="o">==</span>&gt;<span class="w"> </span>LDAP:<span class="w"> </span><span class="nv">dc</span><span class="o">=</span>epics,<span class="w"> </span><span class="nv">dc</span><span class="o">=</span><span class="nv">org</span><span class="w"> </span><span class="o">==</span>&gt;<span class="w"> </span>Cert:<span class="w"> </span><span class="nv">O</span><span class="o">=</span>epics.org
<span class="w">                                             </span>Default<span class="w"> </span>&lt;hostname&gt;
<span class="w">  </span><span class="o">(</span>-p<span class="w"> </span><span class="p">|</span><span class="w"> </span>--password<span class="o">)</span><span class="w"> </span>&lt;name&gt;<span class="w">                   </span>Specify<span class="w"> </span>LDAP<span class="w"> </span>password.<span class="w"> </span>If<span class="w"> </span>not<span class="w"> </span>specified<span class="w"> </span>will<span class="w"> </span>prompt<span class="w"> </span><span class="k">for</span><span class="w"> </span>password
<span class="w">        </span>--ldap-host<span class="w"> </span>&lt;hostname&gt;<span class="w">               </span>LDAP<span class="w"> </span>server<span class="w"> </span>host
<span class="w">        </span>--ldap-port<span class="w"> </span>&lt;port&gt;<span class="w">                   </span>LDAP<span class="w"> </span>serever<span class="w"> </span>port
<span class="w">  </span><span class="o">(</span>-D<span class="w"> </span><span class="p">|</span><span class="w"> </span>--daemon<span class="o">)</span><span class="w">                            </span>Start<span class="w"> </span>a<span class="w"> </span>daemon<span class="w"> </span>that<span class="w"> </span>re-requests<span class="w"> </span>a<span class="w"> </span>certificate<span class="w"> </span>on<span class="w"> </span>expiration<span class="sb">`</span>
<span class="w">        </span>--add-config-uri<span class="w">                     </span>Add<span class="w"> </span>a<span class="w"> </span>config<span class="w"> </span>uri<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>generated<span class="w"> </span>certificate
<span class="w">        </span>--config-uri-base<span class="w"> </span>&lt;config_uri_base&gt;<span class="w">  </span>Specifies<span class="w"> </span>the<span class="w"> </span>config<span class="w"> </span>URI<span class="w"> </span>base<span class="w"> </span>to<span class="w"> </span>add<span class="w"> </span>to<span class="w"> </span>a<span class="w"> </span>certificate.<span class="w">  </span>Default<span class="w"> </span><span class="sb">`</span>CERT:CONFIG<span class="sb">`</span>
<span class="w">        </span>--force<span class="w">                              </span>Force<span class="w"> </span>overwrite<span class="w"> </span><span class="k">if</span><span class="w"> </span>certificate<span class="w"> </span>exists
<span class="w">  </span><span class="o">(</span>-v<span class="w"> </span><span class="p">|</span><span class="w"> </span>--verbose<span class="o">)</span><span class="w">                           </span>Verbose<span class="w"> </span>mode
<span class="w">  </span><span class="o">(</span>-d<span class="w"> </span><span class="p">|</span><span class="w"> </span>--debug<span class="o">)</span><span class="w">                             </span>Debug<span class="w"> </span>mode
</pre></div>
</div>
<p><strong>Environment Variables for authnldap and PVACMS AuthnLDAP Verifier</strong></p>
<p>The environment variables and parameters in the following table configure the authnldap client and
LDAP Credentials Verifier for <a class="reference internal" href="spvacerts.html#pvacms"><span class="std std-ref">PVACMS</span></a> at runtime.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Env. <em>authnldap</em></p></th>
<th class="head"><p>Env. <em>pvacms</em></p></th>
<th class="head"><p>Params. <em>authldap</em></p></th>
<th class="head"><p>Params. <em>pvacms</em></p></th>
<th class="head"><p>Keys and Values</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">EPICS_AUTH_LDAP</div>
<div class="line">_ACCOUNT_PWD_FILE</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">{location of password file}</div>
<div class="line">e.g. <code class="docutils literal notranslate"><span class="pre">~/.config/ldap.pass/</span></code></div>
</div>
</td>
<td><div class="line-block">
<div class="line">file containing password for the given LDAP user account</div>
<div class="line"><br /></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">-p</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">--password</span></code></div>
</div>
</td>
<td><div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">{LDAP account password}</div>
<div class="line">e.g. <code class="docutils literal notranslate"><span class="pre">secret</span></code></div>
</div>
</td>
<td><div class="line-block">
<div class="line">password for the given LDAP user account</div>
<div class="line"><br /></div>
</div>
</td>
</tr>
<tr class="row-even"><td colspan="2"><div class="line-block">
<div class="line">EPICS_AUTH_LDAP_HOST</div>
<div class="line"><br /></div>
</div>
</td>
<td colspan="2"><div class="line-block">
<div class="line"><br /></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">--ldap-host</span></code></div>
</div>
</td>
<td><div class="line-block">
<div class="line">{hostname of LDAP server}</div>
<div class="line">e.g. <code class="docutils literal notranslate"><span class="pre">ldap.stanford.edu</span></code></div>
</div>
</td>
<td><div class="line-block">
<div class="line">Trusted hostname of the LDAP server</div>
<div class="line"><br /></div>
</div>
</td>
</tr>
<tr class="row-odd"><td colspan="2"><div class="line-block">
<div class="line">EPICS_AUTH_LDAP_PORT</div>
<div class="line"><br /></div>
</div>
</td>
<td colspan="2"><div class="line-block">
<div class="line"><br /></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">--ldap-port</span></code></div>
</div>
</td>
<td><div class="line-block">
<div class="line">&lt;port_number&gt;</div>
<div class="line">e.g. <code class="docutils literal notranslate"><span class="pre">389</span></code></div>
</div>
</td>
<td><div class="line-block">
<div class="line">LDAP server port number. Default is 389</div>
<div class="line"><br /></div>
</div>
</td>
</tr>
</tbody>
</table>
</section>
<section id="authjwt-configuration-and-usage">
<h4>authjwt Configuration and Usage<a class="headerlink" href="#authjwt-configuration-and-usage" title="Link to this heading">¶</a></h4>
<p>This Authenticator is a TYPE <code class="docutils literal notranslate"><span class="pre">1</span></code> Authenticator.
It can be used to create a certificate from a JWT token.</p>
<p>The daemon will create a rest service that will allow posting of JWT tokens
and create a certificate based on the token’s credentials.</p>
<p>Verification of the JWT token is performed by <a class="reference internal" href="spvacerts.html#pvacms"><span class="std std-ref">PVACMS</span></a> before exchanging for a certificate.</p>
<p><strong>JWT Token Post Request</strong>
A web application, python script, java application, etc. can post a JWT token to the authentication daemon
whenever it gets a new token from an authentication service.   The authentication daemon will send
a <a class="reference internal" href="spvacerts.html#certificate-creation-request-ccr"><span class="std std-ref">Certificate Creation Request (CCR)</span></a> to <a class="reference internal" href="spvacerts.html#pvacms"><span class="std std-ref">PVACMS</span></a> to create a certificate based on the JWT token.  <a class="reference internal" href="spvacerts.html#pvacms"><span class="std std-ref">PVACMS</span></a> will verify the token based
on the configuration of the authnjwt verifier.</p>
<p>You could test this by posting a JWT token to the authentication daemon as follows:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>authnjwt<span class="w"> </span>-D<span class="w"> </span><span class="p">&amp;</span>

curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8080<span class="w"> </span><span class="se">\</span>
-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer YOUR_JWT_TOKEN_HERE&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>No body is sent in this POST request.</p>
</div>
<ul class="simple">
<li><p><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">CN</span></code> field in the certificate will be the username from the JWT token</p></li>
<li><p><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">O</span></code> field in the certificate will be the issuer from the JWT token</p></li>
<li><p><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">OU</span></code> field in the certificate will not be set</p></li>
<li><p><code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">C</span></code> field in the certificate will be set to the local country code</p></li>
</ul>
<p><strong>usage</strong></p>
<p>Uses the standard <code class="docutils literal notranslate"><span class="pre">EPICS_PVA_TLS_&lt;name&gt;</span></code> environment variables to determine the keychain,
and password file locations.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>authnjwt<span class="w"> </span>&lt;opts&gt;

Options:
-h<span class="w"> </span>show<span class="w"> </span><span class="nb">help</span>
-v<span class="w"> </span>verbose<span class="w"> </span>output
-t<span class="w"> </span><span class="o">{</span>client<span class="w"> </span><span class="p">|</span><span class="w"> </span>server<span class="o">}</span><span class="w">     </span>Client<span class="w"> </span>or<span class="w"> </span>server<span class="w"> </span>certificate<span class="w"> </span>certificate<span class="w"> </span><span class="nb">type</span>
-C<span class="w">                       </span>Create<span class="w"> </span>a<span class="w"> </span>certificate<span class="w"> </span>and<span class="w"> </span><span class="nb">exit</span>
-D<span class="w">                       </span>Start<span class="w"> </span>authentication<span class="w"> </span>daemon<span class="w"> </span>web<span class="w"> </span>service<span class="w"> </span>to<span class="w"> </span>receive
<span class="w">                        </span>JWT<span class="w"> </span>tokens<span class="w"> </span>and<span class="w"> </span>create<span class="w"> </span>certificates.
</pre></div>
</div>
<p><strong>Environment Variables for PVACMS AuthnJWT Verifier</strong></p>
<p>The environment variables in the following table configure the JWT
Credentials Verifier for <a class="reference internal" href="spvacerts.html#pvacms"><span class="std std-ref">PVACMS</span></a> at runtime.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Keys and Values</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">EPICS_AUTH_JWT</div>
<div class="line">_REQUEST_FORMAT</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">{string format for verification request payload}</div>
<div class="line">e.g. <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">&quot;token&quot;:</span> <span class="pre">&quot;#token#&quot;</span> <span class="pre">}</span></code></div>
<div class="line">e.g. <code class="docutils literal notranslate"><span class="pre">#token#</span></code></div>
</div>
</td>
<td><div class="line-block">
<div class="line">Used to create the verification request payload by substituting the #token#</div>
<div class="line">for the token value, and #kid# for the key id. This is used when the</div>
<div class="line">verification server requires a formatted payload for the verification request.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">EPICS_AUTH_JWT</div>
<div class="line">_RESPONSE_FORMAT</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">{string format for verification response value}</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">A pattern string that we can use to decode the response from a verification</div>
<div class="line">endpoint if the response is formatted text. All white space is removed in the</div>
<div class="line">given string and in the response. Then all the text prior to #response# is matched</div>
<div class="line">and removed from the response and all the text after the response is likewise</div>
<div class="line">removed, what remains is the response value. An asterisk in the string matches</div>
<div class="line">any sequence of characters in the response. It is converted to lowercase and</div>
<div class="line">interpreted as valid if it equals valid, ok, true, t, yes, y, or 1.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">EPICS_AUTH_JWT</div>
<div class="line">_TRUSTED_URI</div>
</div>
</td>
<td><div class="line-block">
<div class="line">{uri of JWT validation endpoint}</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">Trusted URI of the validation endpoint – the substring that starts the URI</div>
<div class="line">including the <a class="reference external" href="http://">http://</a>, <a class="reference external" href="https://">https://</a> and port number.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">EPICS_AUTH_JWT_USE</div>
<div class="line">_RESPONSE_CODE</div>
</div>
</td>
<td><div class="line-block">
<div class="line">case insensitive: <code class="docutils literal notranslate"><span class="pre">YES</span></code>, <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, or <code class="docutils literal notranslate"><span class="pre">1</span></code></div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">If set this tells <a class="reference internal" href="spvacerts.html#pvacms"><span class="std std-ref">PVACMS</span></a> that when it receives a 200 HTTP-response from</div>
<div class="line">the HTTP request then the token is valid, and invalid for any other response code.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">EPICS_AUTH_JWT</div>
<div class="line">_REQUEST_METHOD</div>
</div>
</td>
<td><div class="line-block">
<div class="line">{<code class="docutils literal notranslate"><span class="pre">POST</span></code> (default) or <code class="docutils literal notranslate"><span class="pre">GET</span></code>}</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">This determines whether the endpoint will be called with HTTP GET or POST.</div>
<div class="line"><br /></div>
</div>
</td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
<section id="epics-security">
<span id="id6"></span><h2>EPICS Security<a class="headerlink" href="#epics-security" title="Link to this heading">¶</a></h2>
<p>New AUTHORIZATION mechanisms integrate with EPICS Security through four access control mechanisms:</p>
<section id="method">
<h3>METHOD<a class="headerlink" href="#method" title="Link to this heading">¶</a></h3>
<p>Defines access permissions based on Authenticator:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">x509</span></code>: Certificate-based authentication</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ca</span></code>: Legacy PVAccess AUTHZ with user-specified account</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">anonymous</span></code>: Access without specified name</p></li>
</ul>
</section>
<section id="authority">
<h3>AUTHORITY<a class="headerlink" href="#authority" title="Link to this heading">¶</a></h3>
<p>Defines access permissions based on certificate authority:</p>
<ul class="simple">
<li><p>Uses name from <code class="docutils literal notranslate"><span class="pre">CN</span></code> field of certificate authority certificate’s subject</p></li>
<li><p>Only applicable for X.509 certificate authentication</p></li>
</ul>
</section>
<section id="rpc-permission">
<h3>RPC Permission<a class="headerlink" href="#rpc-permission" title="Link to this heading">¶</a></h3>
<p>New rule permission for RPC message access control:</p>
<ul class="simple">
<li><p>Supplements existing <code class="docutils literal notranslate"><span class="pre">NONE</span></code>, <code class="docutils literal notranslate"><span class="pre">READ</span></code> (<code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">GET</span></code>), and <code class="docutils literal notranslate"><span class="pre">WRITE</span></code> (<code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">PUT</span></code>)</p></li>
<li><p>Controls access to <code class="xref cpp cpp-any docutils literal notranslate"><span class="pre">RPC</span></code> PVAccess messages</p></li>
</ul>
</section>
<section id="istls-option">
<h3>ISTLS Option<a class="headerlink" href="#istls-option" title="Link to this heading">¶</a></h3>
<p>New rule option for TLS-based access control:</p>
<ul class="simple">
<li><p>Requires server connection with trusted CA-signed certificate</p></li>
<li><p>Enables READ access restriction to certified PVs only</p></li>
</ul>
</section>
<section id="access-control-file-acf">
<span id="id7"></span><h3>Access Control File (ACF)<a class="headerlink" href="#access-control-file-acf" title="Link to this heading">¶</a></h3>
<p>Example ACF showing new security features:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>UAG(bar) {boss}
UAG(foo) {testing}
UAG(ops) {geek}

ASG(DEFAULT) {
    RULE(0,NONE,NOTRAPWRITE)
}

ASG(ro) {
    RULE(0,NONE,NOTRAPWRITE)
    RULE(1,READ,ISTLS) {
        UAG(foo,ops)
        METHOD(&quot;ca&quot;)
    }
}

ASG(rw) {
    RULE(0,NONE,NOTRAPWRITE)
    RULE(1,WRITE,TRAPWRITE) {
        UAG(foo)
        METHOD(&quot;x509&quot;)
        AUTHORITY(&quot;EPICS Root Certificate Authority&quot;)
    }
}

ASG(rwx) {
    RULE(0,NONE,NOTRAPWRITE)
    RULE(1,RPC,NOTRAPWRITE) {
        UAG(bar)
        METHOD(&quot;x509&quot;)
        AUTHORITY(&quot;EPICS Root Certificate Authority&quot;,&quot;ORNL Org Certificate Authority&quot;)
    }
}
</pre></div>
</div>
</section>
<section id="epics-yaml-acf-format">
<span id="new-epics-yaml-acf-file-format"></span><h3>EPICS YAML ACF Format<a class="headerlink" href="#epics-yaml-acf-format" title="Link to this heading">¶</a></h3>
<p>Alternative YAML format for improved readability:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># EPICS YAML</span>
<span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>

<span class="nt">uags</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bar</span>
<span class="w">    </span><span class="nt">users</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">boss</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foo</span>
<span class="w">    </span><span class="nt">users</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">testing</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ops</span>
<span class="w">    </span><span class="nt">users</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">geek</span>

<span class="nt">asgs</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ro</span>
<span class="w">    </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">        </span><span class="nt">access</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NONE</span>
<span class="w">        </span><span class="nt">trapwrite</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">        </span><span class="nt">access</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">READ</span>
<span class="w">        </span><span class="nt">isTLS</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="nt">uags</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foo</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ops</span>
<span class="w">        </span><span class="nt">methods</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ca</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rw</span>
<span class="w">    </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">        </span><span class="nt">access</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NONE</span>
<span class="w">        </span><span class="nt">trapwrite</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">        </span><span class="nt">access</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">WRITE</span>
<span class="w">        </span><span class="nt">trapwrite</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="nt">uags</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foo</span>
<span class="w">        </span><span class="nt">methods</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">x509</span>
<span class="w">        </span><span class="nt">authorities</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SLAC Certificate Authority</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rwx</span>
<span class="w">    </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">        </span><span class="nt">access</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NONE</span>
<span class="w">        </span><span class="nt">trapwrite</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">        </span><span class="nt">access</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RPC</span>
<span class="w">        </span><span class="nt">trapwrite</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="nt">uags</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bar</span>
<span class="w">        </span><span class="nt">methods</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">x509</span>
<span class="w">        </span><span class="nt">authorities</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SLAC Certificate Authority</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ORNL Org Certificate Authority</span>
</pre></div>
</div>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">PVXS</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="netconfig.html">PVA Network Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="spvaqstart.html"><i class="material-symbols-outlined" style="vertical-align: middle;">developer_guide</i> Secure PVXS</a></li>
<li class="toctree-l1"><a class="reference internal" href="spvaqstartstd.html"><i class="material-symbols-outlined" style="vertical-align: middle;">developer_guide</i> Std. Authenticator</a></li>
<li class="toctree-l1"><a class="reference internal" href="spvaqstartkrb.html"><i class="material-symbols-outlined" style="vertical-align: middle;">developer_guide</i> KRB Authenticator</a></li>
<li class="toctree-l1"><a class="reference internal" href="spvaqstartldap.html"><i class="material-symbols-outlined" style="vertical-align: middle;">developer_guide</i> LDAP Authenticator</a></li>
<li class="toctree-l1"><a class="reference internal" href="spva.html"><i class="material-symbols-outlined" style="vertical-align: middle;">security</i> Secure PVAccess</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#"><i class="material-symbols-outlined" style="vertical-align: middle;">security</i> AuthN &amp; AuthZ</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#authentication-modes">Authentication Modes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#legacy-authentication-mode">Legacy Authentication Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#secure-pvaccess-authentication-mode">Secure PVAccess Authentication Mode</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#authentication-methods">Authentication Methods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#authenticator-implementation">1. Authenticator Implementation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ccr-message-verifier">2. CCR Message Verifier</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build-flag-to-enable-code-to-be-compiled-in">3. Build flag to enable code to be compiled in</a></li>
<li class="toctree-l3"><a class="reference internal" href="#extra-options-for-pvacms">4. Extra options for PVACMS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#extra-environment-variables-for-pvacms">5. Extra environment variables for PVACMS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#authenticators">Authenticators</a></li>
<li class="toctree-l3"><a class="reference internal" href="#common-environment-variables-for-all-authenticators">Common Environment Variables for all Authenticators</a></li>
<li class="toctree-l3"><a class="reference internal" href="#included-reference-authenticators">Included Reference Authenticators</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#epics-security">EPICS Security</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#method">METHOD</a></li>
<li class="toctree-l3"><a class="reference internal" href="#authority">AUTHORITY</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rpc-permission">RPC Permission</a></li>
<li class="toctree-l3"><a class="reference internal" href="#istls-option">ISTLS Option</a></li>
<li class="toctree-l3"><a class="reference internal" href="#access-control-file-acf">Access Control File (ACF)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#epics-yaml-acf-format">EPICS YAML ACF Format</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="spvacerts.html"><i class="material-symbols-outlined" style="vertical-align: middle;">security</i> Cert Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="example.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="building.html">Building from Source</a></li>
<li class="toctree-l1"><a class="reference internal" href="building.html#including-pvxs-in-your-application">Including PVXS in your application</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command Line Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="value.html">Value Container API</a></li>
<li class="toctree-l1"><a class="reference internal" href="client.html">Client API</a></li>
<li class="toctree-l1"><a class="reference internal" href="server.html">Server API</a></li>
<li class="toctree-l1"><a class="reference internal" href="ioc.html">IOC Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="ioc.html#qsrv-2">QSRV 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="util.html">Misc</a></li>
<li class="toctree-l1"><a class="reference internal" href="details.html">Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="spvaglossary.html"><i class="material-symbols-outlined" style="vertical-align: middle;">security</i> SPVA Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="releasenotes.html">Release Notes</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="spva.html" title="previous chapter"><i class="material-symbols-outlined" style="vertical-align: middle;">security</i> Secure PVAccess</a></li>
      <li>Next: <a href="spvacerts.html" title="next chapter"><i class="material-symbols-outlined" style="vertical-align: middle;">security</i> Cert Management</a></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025 Michael Davidsaver, George McIntyre, Osprey DCS LLC, and SLAC.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/spvaauth.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>